"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const typeConverters = tslib_1.__importStar(require("../utils/typeConverters"));
class TypeScriptReferences {
    constructor(client) {
        this.client = client;
    }
    provideReferences(document, position, context, token) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            const filepath = this.client.toPath(document.uri);
            if (!filepath)
                return [];
            const args = typeConverters.Position.toFileLocationRequestArgs(filepath, position);
            try {
                const msg = yield this.client.execute('references', args, token);
                if (!msg.body) {
                    return [];
                }
                const result = [];
                for (const ref of msg.body.refs) {
                    if (!context.includeDeclaration && ref.isDefinition) {
                        continue;
                    }
                    const url = this.client.toResource(ref.file);
                    const location = typeConverters.Location.fromTextSpan(url, ref);
                    result.push(location);
                }
                return result;
            }
            catch (_a) {
                return [];
            }
        });
    }
}
exports.default = TypeScriptReferences;
//# sourceMappingURL=references.js.map
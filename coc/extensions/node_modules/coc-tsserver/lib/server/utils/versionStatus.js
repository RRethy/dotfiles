"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const coc_nvim_1 = require("coc.nvim");
const vscode_uri_1 = tslib_1.__importDefault(require("vscode-uri"));
class VersionStatus {
    constructor(_normalizePath) {
        this._normalizePath = _normalizePath;
        this._versionBarEntry = coc_nvim_1.workspace.createStatusBarItem(99);
        this._onChangeEditorSub = coc_nvim_1.events.on('BufEnter', this.showHideStatus, this);
        this._versionBarEntry.show();
    }
    dispose() {
        this._versionBarEntry.dispose();
        this._onChangeEditorSub.dispose();
    }
    onDidChangeTypeScriptVersion(version) {
        this._versionBarEntry.text = `TSC ${version.versionString}`;
        this.showHideStatus().catch(_e => {
            // noop
        });
    }
    showHideStatus() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            let document = yield coc_nvim_1.workspace.document;
            if (!document) {
                this._versionBarEntry.hide();
                return;
            }
            if (['typescript', 'typescriptreact'].indexOf(document.filetype) !== -1) {
                if (this._normalizePath(vscode_uri_1.default.parse(document.uri))) {
                    this._versionBarEntry.show();
                }
                else {
                    this._versionBarEntry.hide();
                }
                return;
            }
            this._versionBarEntry.hide();
        });
    }
}
exports.default = VersionStatus;
//# sourceMappingURL=versionStatus.js.map